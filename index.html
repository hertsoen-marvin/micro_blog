<header>
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="intro-text">
                    <span class="name">Le fil</span>
                    <hr class="star-light">
                </div>
            </div>
        </div>
    </div>
</header>

<!-- About Section -->
<section>
    <div class="container">
        <div class="row">

            {if isset($a)}
              {if $a == 'mod' and $id }
                <form method="GET" action="messages.php">

                    <div class="col-sm-10">

                      <div class="form-group">
                        <textarea id="message" name="message" class="form-control" placeholder="" rows="3" style='resize:none;'> {$contenu} </textarea>
                      </div>

                        <input type="hidden"  name="a"  value="mod">
                        <input type='hidden'  name='id'  value="{$id}">

                    </div>
                    <div class="col-sm-2">
                      <button type="submit" class="btn btn-success btn-lg" style='width:100%; height:74px;'>Modifier</button><br/><br/>
                      <!--<a href='index.php'><button class="btn btn-success btn-lg">Annuler</button></a>-->
                    </div>
                  </form>


              {/if}
            {else}

              <form method="GET" action="messages.php">
                {if $connecte_util}
                  <input type="hidden"  name="a"  value="crea">
                {/if}

                <div class="row">

                    <div class="col-sm-10 box">
                      <div class="form-group">
                        {if $connecte_util}
                          <textarea id="message" name="message" class="form-control" placeholder="Rédigez votre message" rows="3" style='resize:none;'></textarea>
                        {/if}
                      </div>
                    </div>

                    <div class="col-sm-2 box">
                        {if $connecte_util}
                        <button type="submit" class="btn btn-success " style='width:100%; height:74px;'>Envoyer</button>
                        {/if}
                    </div>
                </div>
              </form>

            {/if}
      </div>
      <br /> <br />

      <div class="row">
          <form id='search_form' method="GET" action="index.php">
                <span class="glyphicon glyphicon-search"></span>
                <input type="text" name='search_bar' class='search_bar' class="form-control"  placeholder="Rechercher un message" >
          </form>
      </div>




      <div class="row">
          <div class="col-md-12">

            {foreach foreach from=$messages item=row}
              <blockquote class='blockquote cus_blockquote'>
                <p> {$row['contenu']}
                  {if strlen($row['contenu']) > 99 }
                    <a class='ancreAfficherTout text-white bg-primary' href='#' idBD="{$row['id']}">Afficher tout <span class="glyphicon glyphicon-triangle-bottom" aria-hidden="true"></span>
                    </a>
                  {/if}
                </p>
                <footer> {$row['date']|date_format:"%d/%m/%Y à %H:%M"}

                  {if $connecte_util}
                  <a href='messages.php?a=sup&id={$row["id"]}' class=' bouton btn btn-danger btn-sm'> Supprimer</a>
                  <a href='index.php?a=mod&id={$row["id"]}&contenu={$row["raw_contenu"]}' idBD='{$row["id"]}' class="btn_modif bouton btn btn-warning btn-sm"> Modifier</a>
                  {/if}
                </footer>
              </blockquote>


              {if $connecte_util}
              <!--  <a href='messages.php?a=sup&id={$row["id"]}' class='bouton btn btn-danger'> Supprimer</a>
                <a href='index.php?a=mod&id={$row["id"]}&contenu={$row["raw_contenu"]}' class="bouton btn btn-warning"> Modifier</a>-->
              {/if}
              <br /> <br />
            {/foreach}

            </div>
        </div>

        <a href='#' class='sprite facebook'></a>


        <div class="row">
            <ul class="pagination pull-right">
              {for $i=1 to $nb_cases_pagination}
                <li><a href="index.php?selected_page={$i}">{$i}</a></li>
              {/for}

              <!--<li class="disabled"><a href="#">4</a></li>-->
            </ul>
        </div>

    </div>
</section>
<script type="text/javascript">
  $(document).ready(function(){

    $(".ancreAfficherTout").click(function(e){
      e.preventDefault();
      var idBD = $(this).attr('idBD');
      $.get("messages.php?ajaxRequest=getAllMessage&id_message="+idBD).done(function(data){
        console.log(data);
          data_parsed = JSON.parse(data);
          if(data_parsed.contenu){
            $('.container blockquote .ancreAfficherTout[idBD='+idBD+']').closest("blockquote").find('p').html(data_parsed.contenu);
            $('.container blockquote .ancreAfficherTout[idBD='+idBD+']').remove();
          }
        });
    });

    $(".btn_modif").click(function(e){
      e.preventDefault();
      var idBD = $(this).attr('idBD');
      $.get("messages.php?ajaxRequest=getAllMessage&id_message="+idBD).done(function(data){
          data_parsed = JSON.parse(data);
          if(data_parsed.contenu){
            window.location = "index.php?a=mod&id="+idBD+"&contenu="+data_parsed.contenu;
          }
        });
    });


});
</script>
